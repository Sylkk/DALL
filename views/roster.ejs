<!DOCTYPE html>
<html>

<% include partials/_header %>

<body class="">

    <div id="wrapper">

        <!-- LEFT Navigation bar -->
        <% include partials/_left_navbar %>
        <!-- END OF LEFT Navigation bar -->

        <!-- PAGE WRAPPER -->
        <div id="page-wrapper" class="gray-bg">
            <!-- TOP NAV BAR -->
            <% include partials/_top_navbar %>
            <!-- END TOP NAV BAR -->

            <!-- TITLE BAR -->
            <div class="row wrapper border-bottom white-bg page-heading">
                <div class="col-sm-4">
                    <h2><%= title %></h2>
                    <ol class="breadcrumb">
                        <li>
                            <a href="/home">Home</a>
                        </li>
                        <li class="active">
                            <strong><%= title %></strong>
                        </li>
                    </ol>
                </div>
                <div class="col-sm-8">
                    <div class="title-action">    
                        
                        <!-- filter -->
                        <button name="filterRoster" class="btn btn-white">
                            <i class="fa fa-filter"></i>
                            <span class="bold">Filters</span>
                        </button>
                        <!-- update all --><%if(user.rank >= 7){ %>
                        <button name="all_<%= user._id %>" type="submit" class="btn btn-white">
                            <i class="fa fa-refresh"></i>
                            <span class="bold">Update All</span>
                        </button>
                        <% } %>
                    </div>
                </div>
            </div>
            <!-- END TITLE BAR -->

            <!-- CONTENT BAR -->
            <div class="wrapper wrapper-content animated fadeInRight">
                
                <div class="tabs-container">
                    <ul class="nav nav-tabs">
                        <li class="active"><a data-toggle="tab" href="#tab-1" aria-expanded="true">Gear</a></li>
                        <li class=""><a data-toggle="tab" href="#tab-2" aria-expanded="false">Progress</a></li>
                        <li class=""><a data-toggle="tab" href="#tab-3" aria-expanded="false">Professions</a></li>
                    </ul>
                    <div class="tab-content">
                        <div id="tab-1" class="tab-pane active">
                            <div class="panel-body">
                                
                                <% var plaqueSum=0, mailleSum=0, cuirSum=0, tissuSum=0; %>
                                <% var vanquisherSum=0, conquerorSum=0, protectorSum=0; %>
                                <% var tankSum=0, healerSum=0, meleeSum=0, casterSum=0;%>
                                <% chars.forEach(function(chara){
                                    if (chara.class === 1){ //warr
                                        plaqueSum++;
                                        protectorSum++;
                                    }if (chara.class === 2){ //paladin
                                        plaqueSum++;
                                        conquerorSum++;
                                    }if (chara.class === 3){ //hunter
                                        mailleSum++;
                                        protectorSum++;
                                    }if (chara.class === 4){ //rogue
                                        cuirSum++;
                                        vanquisherSum++;
                                    }if (chara.class === 5){ //priest
                                        tissuSum++;
                                        conquerorSum++;
                                    }if (chara.class === 6){ //DK
                                        plaqueSum++;
                                        vanquisherSum++;
                                    }if (chara.class === 7){ //Shaman
                                        mailleSum++;
                                        protectorSum++;
                                    }if (chara.class === 8){ //Mage
                                        tissuSum++;
                                        vanquisherSum++;
                                    }if (chara.class === 9){ //Warlock
                                        tissuSum++;
                                        conquerorSum++;
                                    }if (chara.class === 10){ //Monk
                                        cuirSum++;
                                        protectorSum++;
                                    }if (chara.class === 11){ //Druid
                                        cuirSum++;
                                        vanquisherSum++;
                                    }if (chara.class === 12){ //DH
                                        cuirSum++;
                                        conquerorSum++;
                                    }

                                    if(chara.role === "TANK"){
                                        tankSum++;
                                    }if(chara.role === "HEAL"){
                                        healerSum++;
                                    }if(chara.role === "MELEE"){
                                        meleeSum++;
                                    }if(chara.role === "CASTER"){
                                        casterSum++;
                                    }
                                }) %>

                                <div class="col-md-9" id="filterRoster" hidden>
                                    <fieldset class="col-md-12">
                                        <legend>Classes </legend>
                                        <div class="checkbox checkbox-inline checkbox-primary" style="color:#C79C6E">
                                            <input type="checkbox" id="checkboxWar" value="warrior">
                                            <label for="checkboxWar">Warrior</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary" style="color:#F58CBA">
                                            <input type="checkbox" id="checkboxPala" value="paladin">
                                            <label for="checkboxPala">Paladin</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary" style="color:#ABD473">
                                            <input type="checkbox" id="checkboxHunt" value="hunter">
                                            <label for="checkboxHunt">Hunter</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary" style="color:#E5B307">
                                            <input type="checkbox" id="checkboxRogue" value="rogue">
                                            <label for="checkboxRogue">Rogue</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary" style="color:#000000">
                                            <input type="checkbox" id="checkboxPriest" value="priest">
                                            <label for="checkboxPriest">Priest</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary" style="color:#C41F3B">
                                            <input type="checkbox" id="checkboxDK" value="DK">
                                            <label for="checkboxDK">DK</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary" style="color:#0070DE">
                                            <input type="checkbox" id="checkboxSham" value="shaman">
                                            <label for="checkboxSham">Shaman</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary" style="color:#69CCF0">
                                            <input type="checkbox" id="checkboxMage" value="mage" >
                                            <label for="checkboxMage">Mage</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary" style="color:#9482C9">
                                            <input type="checkbox" id="checkboxWarlock" value="warlock">
                                            <label for="checkboxWarlock">Warlock</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary" style="color:#00FF96">
                                            <input type="checkbox" id="checkboxMonk" value="monk">
                                            <label for="checkboxMonk">Monk</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary" style="color:#FF7D0A">
                                            <input type="checkbox" id="checkboxDruid" value="druid">
                                            <label for="checkboxDruid">Druide</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary" style="color:#4D6884">
                                            <input type="checkbox" id="checkboxDH" value="DH">
                                            <label for="checkboxDH">DH</label>
                                        </div>
                                        <br/><br/>
                                    </fieldset>
                                    <fieldset class="col-md-4">
                                        <legend>Gear </legend>
                                        <div class="checkbox checkbox-inline checkbox-primary">
                                            <input type="checkbox" id="checkboxPlaque" value="warrior|paladin|DK">
                                            <label for="checkboxPlaque">Plaque (<%=plaqueSum%>)</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary">
                                            <input type="checkbox" id="checkboxMaille" value="hunter|shaman">
                                            <label for="checkboxMaille">Maille (<%=mailleSum%>)</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary">
                                            <input type="checkbox" id="checkboxCuir" value="rogue|monk|druid|DH">
                                            <label for="checkboxCuir">Cuir (<%=cuirSum%>)</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary">
                                            <input type="checkbox" id="checkboxTissu" value="priest|mage|warlock">
                                            <label for="checkboxTissu">Tissu (<%=tissuSum%>)</label>
                                        </div>
                                        <br/><br/>
                                    </fieldset>
                                    <fieldset class="col-md-4">
                                        <legend>Token </legend>
                                        <div class="checkbox checkbox-inline checkbox-primary token1" title="Rogue, DK, Mage, Druide">
                                            <input type="checkbox" id="checkboxVanquisher" value="rogue|DK|mage|druid">
                                            <label for="checkboxVanquisher">Vanquisher (<%=vanquisherSum%>)</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary token2" title="Pal, Priest, Demo, DH">
                                            <input type="checkbox" id="checkboxConqueror" value="paladin|priest|warlock|DH">
                                            <label for="checkboxConqueror">Conqueror (<%=conquerorSum%>)</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary token3" title="War, Hunt, Sham, Monk">
                                            <input type="checkbox" id="checkboxProtector" value="warrior|hunter|shaman|monk">
                                            <label for="checkboxProtector">Protector (<%=protectorSum%>)</label>
                                        </div>
                                        <br/><br/>
                                    </fieldset>
                                    <fieldset class="col-md-4">
                                        <legend>Rôle</legend>
                                        <div class="checkbox checkbox-inline checkbox-primary">
                                            <input type="checkbox" id="checkboxTank" value="TANK">
                                            <label for="checkboxTank">Tank (<%=tankSum%>)</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary">
                                            <input type="checkbox" id="checkboxHeal" value="HEAL">
                                            <label for="checkboxHeal">Heal (<%=healerSum%>)</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary">
                                            <input type="checkbox" id="checkboxMelee" value="MELEE">
                                            <label for="checkboxMelee">Melee (<%=meleeSum%>)</label>
                                        </div>
                                        <div class="checkbox checkbox-inline checkbox-primary">
                                            <input type="checkbox" id="checkboxCaster" value="CASTER">
                                            <label for="checkboxCaster">Caster (<%=casterSum%>)</label>
                                        </div>
                                        <br/><br/>
                                    </fieldset>
                                </div>

                                <table class="table table-striped table-bordered table-hover dataTable-roster dataTable listing-roster-items" id="rosterTable" role="grid">
                                    <thead>
                                        <tr role="row">
                                            <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 10px;"></th>
                                            <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 10px;"></th>
                                            <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="">classe</th>
                                            <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="min-width: 80px;">Name</th>
                                            <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 10px;"></th>
                                            <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="min-width: 150px;max-width: 150px;"><center>Artefact</center></th>
                                            <th class="sorting" tabindex="0" rowpsan="1" colspan="1" style="min-width: 30px;"></th>
                                            <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 10px;">Relics</th>
                                            <th class="sorting" tabIndex="0" rowspan="1" colspan="1" style="min-width: 20px;"></th>
                                            <th class="sorting" tabindex="0" rowspan="1" colspan="7" style="min-width: 222px;"><center>Tokens</center></th>
                                            <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 35px;">Tri.1</th>
                                            <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 35px;">Tri.2</th>
                                            <th class="sorting" tabindex="0" rowspan="1" colspan="1" style=""><span class="fa fa-warning"></span></th>
                                            <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="min-width: 90px;">update</th>
                                        </tr>
                                    </thead>
                                    
                                    <tbody>
                                        <% chars.forEach(function(chara){ %>
                                        
                                        <tr class="" role="row">
                                            <!-- modal view -->
                                            <td><%=chara.role%></td>
                                            <td>
                                                <center>
                                                    <button class="btn btn-white btn-xs more-infos" data-toggle="modal" data-target="#modal_<%=chara._id%>" tabindex="-1" title="Gear infos">
                                                        <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
                                                    </button>
                                                </center>
                                            </td>
                                            <td><%=chara.getClassName()%></td>
                                            <td>
                                                <img src="<%=chara.getClassIcon() %>" width="16" height="16"/>
                                                <b><a href="/profile/<%= chara.realm %>/<%= chara.name %>">
                                                    <span name="<%= chara._id%>" style="color:<%=chara.getClassColor()%>"><%=chara.name%></span>
                                                </a></b>
                                            </td>
                                            <!-- Ilvl -->
                                            <td class="ilvl" title="Bag ilvl : <%=chara.ilvl%>"><span ><%=chara.ilvle%></span></td>
                                            <!-- Artefact -->
                                            <td>
                                                <% var relics = chara.getiListRelic(chara.getItems().mainHand); %>
                                                
                                                <% var i = chara.getItems().mainHand; %>
                                                <%if(i){%>
                                                <a href="//www.wowhead.com/item=<%=i.id%>" rel="<%=chara.getiWowHeadRel(i)%>" class="<%=chara.getiQuality(i)%>">
                                                   <img src="http://media.blizzard.com/wow/icons/36/<%=i.icon%>.jpg" width="16" height="16"/>
                                                   <b> <%=i.itemLevel%> <%=i.name.substring(0,12);%><%if(i.name.length > 12){%><%=".."%><%}%></b>
                                                </a>
                                                <%}%>
                                            </td>
                                            <!-- AP -->
                                            <td>
                                                <% var APlvl = chara.getArtifactTraits(i) - relics.length %>
                                                <% var maxAPlvl = chara.highestArtLvl %>
                                                <center><span class="artifactLevel" style="color: 
                                                <%
                                                if(APlvl >= 52 || maxAPlvl >= 52){%>
                                                    #3C983B    
                                                <%}else if(APlvl >= 35 || maxAPlvl >= 35){%>
                                                    #ab0617
                                                <%}else{%>
                                                    #e5cc80
                                                <%}%>" title=""><b><%- APlvl %></b> <small>(<%= maxAPlvl %>)</small></span></center>
                                            </td>
                                            <!-- Relics -->
                                            <!-- { "bonusLists": [ 3413, 1502, 1813 ], "context": 33, "itemId": 137381, "socket": 0 } -->
                                            <td>
                                                <%# var relics = chara.getiListRelic(chara.getItems().mainHand); %>
                                                <% if(relics[0]){%>
                                                    <a href="//www.wowhead.com/item=<%=relics[0].itemId%>" rel="bonus=<%=chara.getiListRelicBonusList(relics[0].bonusLists)%>" class="">
                                                       <img src="http://media.blizzard.com/wow/icons/36/inv_wand_14.jpg" width="16" height="16"/>
                                                    </a>
                                                <% } %>
                                                <% if(relics[1]){%>
                                                    <a href="//www.wowhead.com/item=<%=relics[1].itemId%>" rel="bonus=<%=chara.getiListRelicBonusList(relics[1].bonusLists)%>" class="">
                                                       <img src="http://media.blizzard.com/wow/icons/36/inv_wand_14.jpg" width="16" height="16"/>
                                                    </a>
                                                <% } %>
                                                <% if(relics[2]){%>
                                                    <a href="//www.wowhead.com/item=<%=relics[2].itemId%>" rel="bonus=<%=chara.getiListRelicBonusList(relics[2].bonusLists)%>" class="">
                                                       <img src="http://media.blizzard.com/wow/icons/36/inv_wand_14.jpg" width="16" height="16"/>
                                                    </a>
                                                <% } %>
                                            </td>
                                            <!-- Legendary item equipped -->
                                            <td>
                                                <% for (var i=0; i<chara.getiListLeg().length; i++){ %>
                                                <% var item = chara.getItems()[chara.getiListLeg()[i]]; %>
                                                    <a href="//www.wowhead.com/item=<%=item.id%>" rel="<%=chara.getiWowHeadRel(item)%>" class="<%=chara.getiQuality(item)%>">
                                                       <img src="http://media.blizzard.com/wow/icons/36/<%=item.icon%>.jpg" width="16" height="16"/>
                                                    </a>
                                                <% } %>
                                            </td>
                                            <!-- TOKENS -->
                                            <!-- total -->
                                            <td><%-chara.getiTokens()%></td>
                                            <!-- head -->
                                            <td class="rosterToken"><% var i = chara.getItems().head;%>
                                                <center><%if(chara.isiToken(i)){;%>
                                                    <a href="//www.wowhead.com/item=<%=i.id%>" rel="<%=chara.getiWowHeadRel(i)%>" class="<%=chara.getiQuality(i)%>">
                                                        <img src="http://media.blizzard.com/wow/icons/36/<%=i.icon%>.jpg" width="16" height="16"/>
                                                    </a>
                                                    <span class="itemLevelNote"><%=i.itemLevel%></span>
                                                <%}%></center>
                                            </td>
                                            <!-- shoulder -->
                                            <td class="rosterToken"><% var i = chara.getItems().shoulder;%>
                                                <center><%if(chara.isiToken(i)){;%>
                                                    <a href="//www.wowhead.com/item=<%=i.id%>" rel="<%=chara.getiWowHeadRel(i)%>" class="<%=chara.getiQuality(i)%>">
                                                        <img src="http://media.blizzard.com/wow/icons/36/<%=i.icon%>.jpg" width="16" height="16"/>
                                                    </a>
                                                    <span class="itemLevelNote"><%=i.itemLevel%></span>
                                                <%}%></center>
                                            </td>
                                            <!-- chest -->
                                            <td class="rosterToken"><% var i = chara.getItems().chest;%>
                                                <center><%if(chara.isiToken(i)){;%>
                                                    <a href="//www.wowhead.com/item=<%=i.id%>" rel="<%=chara.getiWowHeadRel(i)%>" class="<%=chara.getiQuality(i)%>">
                                                        <img src="http://media.blizzard.com/wow/icons/36/<%=i.icon%>.jpg" width="16" height="16"/>
                                                    </a>
                                                    <span class="itemLevelNote"><%=i.itemLevel%></span>
                                                <%}%></center>
                                            </td>
                                            <!-- back -->
                                            <td class="rosterToken"><% var i = chara.getItems().back;%>
                                                <center><%if(chara.isiToken(i)){;%>
                                                    <a href="//www.wowhead.com/item=<%=i.id%>" rel="<%=chara.getiWowHeadRel(i)%>" class="<%=chara.getiQuality(i)%>">
                                                        <img src="http://media.blizzard.com/wow/icons/36/<%=i.icon%>.jpg" width="16" height="16"/>
                                                    </a>
                                                    <span class="itemLevelNote"><%=i.itemLevel%></span>
                                                <%}%></center>
                                            </td>
                                            <!-- hands -->
                                            <td class="rosterToken"><% var i = chara.getItems().hands;%>
                                                <center><%if(chara.isiToken(i)){;%>
                                                    <a href="//www.wowhead.com/item=<%=i.id%>" rel="<%=chara.getiWowHeadRel(i)%>" class="<%=chara.getiQuality(i)%>">
                                                        <img src="http://media.blizzard.com/wow/icons/36/<%=i.icon%>.jpg" width="16" height="16"/>
                                                    </a>
                                                    <span class="itemLevelNote"><%=i.itemLevel%></span>
                                                <%}%></center>
                                            </td>
                                            <!-- legs -->
                                            <td class="rosterToken"><% var i = chara.getItems().legs;%>
                                                <center><%if(chara.isiToken(i)){;%>
                                                    <a href="//www.wowhead.com/item=<%=i.id%>" rel="<%=chara.getiWowHeadRel(i)%>" class="<%=chara.getiQuality(i)%>">
                                                        <img src="http://media.blizzard.com/wow/icons/36/<%=i.icon%>.jpg" width="16" height="16"/>
                                                    </a>
                                                    <span class="itemLevelNote"><%=i.itemLevel%></span>
                                                <%}%></center>
                                            </td>
                                            <!-- FIN TOKENS -->
                                            <!-- TRINKETS -->
                                            <td>
                                                <% var i = chara.getItems().trinket1; %>
                                                <%if(i){%>
                                                <a href="//www.wowhead.com/item=<%=i.id%>" rel="<%=chara.getiWowHeadRel(i)%>" class="<%=chara.getiQuality(i)%>">
                                                    <img src="http://media.blizzard.com/wow/icons/36/<%=i.icon%>.jpg" width="16" height="16"/><b> <%=i.itemLevel;%></b>
                                                </a>
                                                <%}%>
                                            </td>
                                            <td>
                                                <% var i = chara.getItems().trinket2; %>
                                                <%if(i){%>
                                                <a href="//www.wowhead.com/item=<%=i.id%>" rel="<%=chara.getiWowHeadRel(i)%>" class="<%=chara.getiQuality(i)%>">
                                                    <img src="http://media.blizzard.com/wow/icons/36/<%=i.icon%>.jpg" width="16" height="16"/><b> <%= i.itemLevel; %></b>
                                                </a>
                                                <%}%>
                                            </td>
                                            <!-- WARNING MISSING -->
                                            <td class="rosterMissing" >
                                                <% for (var i=0; i<chara.getiAllEmptySocket().length; i++){ %>
                                                <img src="/img/misc/socketEmpty.png" class="emptySocket" width="14" height="14" title="Empty Socket on :<br/><%-chara.getiAllEmptySocket()[i];%>"/>
                                                <% } %>
                                                <% for (var i=0; i<chara.getiAllEmptyEnchant().length; i++){ %>
                                                <img src="/img/misc/enchantEmpty.jpg" class="emptyEnchant" width="14" height="14" title="Missing Enchant on :<br/><%-chara.getiAllEmptyEnchant()[i];%>"/>
                                                <% } %>
                                            </td>
                                            <td><%=moment(chara.lastUpdated).fromNow()%></td>
                                        </tr>
                                        
                                        <!-- modal informations -->
                                        <div class="modal inmodal" id="modal_<%=chara._id%>" tabindex="-1" role="dialog" aria-hidden="true" data-vivaldi-spatnav-clickable="1" style="display: none;">
                                            <div class="modal-dialog">
                                            <div class="modal-content animated fadeIn">
                                                    <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                                                        <img src="<%=chara.getCharIcon()%>" class="img-circle"/>
                                                        <h4 class="modal-title" style="color:<%= chara.getClassColor()%>"><%= chara.name %></h4>
                                                        <small class="font-bold">Level <%=chara.lvl%> <%=chara.getClassName()%> - Item Level <%=chara.ilvl%> (<%=chara.ilvle%>) - <%=chara.role%></small>
                                                    </div>
                                                    <div class="modal-body">
                                                        <h3>Gear (<%=chara.ilvle %>)</h3>
                                                        <% var items = ["mainHand","offHand","trinket1","trinket2","finger1","finger2","feet","legs","waist","hands","wrist","chest","back","shoulder","neck","head"]; %>
                                                        <ul>
                                                        <% for(var i in items){ %>
                                                            <li class="listing-roster-items">
                                                            <!-- item level -->
                                                            <% if(typeof chara.getItems()[items[i]] !== "undefined"){ %>
                                                                <% var item = chara.getItems()[items[i]]; %>
                                                                <%= item.itemLevel%>
                                                            
                                                                &nbsp&nbsp
                                                                <!-- items list -->
                                                                <a href="//www.wowhead.com/item=<%=item.id%>" rel="<%=chara.getiWowHeadRel(item)%>" class="<%=chara.getiQuality(item)%>">
                                                                    <img src="http://media.blizzard.com/wow/icons/36/<%=item.icon%>.jpg" width="16" height="16"/><b> [<%=item.name%>] </b>
                                                                </a>
                                                            <% } %>
                                                            
                                                            </li>
                                                        <% } %>
                                                        </ul>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- END OF modal information< -->
                                        <% })%>
                                    </tbody>
                                    
                                    <tfoot>
                                        <tr>
                                            <th rowspan="1" colspan="1">Role</th>
                                            <th rowspan="1" colspan="1"></th>
                                            <th rowspan="1" colspan="1">classe</th>
                                            <th rowspan="1" colspan="1">Name</th>
                                            <th rowspan="1" colspan="1">Ilvle</th>
                                            <th rowspan="1" colspan="1"><center>Artefact</center></th>
                                            <th rowspan="1" colspan="1"><center>AP</center></th>
                                            <th rowspan="1" colspan="1"><center>Relics</center></th>
                                            <th rowspan="1" colspan="1"><center>Leg</center></th>
                                            <th rowspan="1" colspan="7"><center>Tokens</center></th>
                                            <th rowspan="1" colspan="1">Trinket1</th>
                                            <th rowspan="1" colspan="1">Trinket2</th>
                                            <th rowspan="1" colspan="1"><span class="fa fa-warning"></span></th>
                                            <th rowspan="1" colspan="1">update</th>
                                        </tr>
                                    </tfoot>
                                </table>

                            </div>
                        </div>
                        
                        
                        <div id="tab-2" class="tab-pane">
                            <div class="panel-body">
                                <div class="col-md-12">
                                    <div class="alert alert-warning alert-dismissable">
                                        <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                                        M+ non 100% viable (ya des trous dans le feedback de Blizzard sous certaine conditions). Rouge = non check, Noir = Check.
                                    </div>
                                    <!-- PROGRESS DUNGEONS & AP -->
                                        <table class="table table-striped table-bordered table-hover dataTable-progress dataTable bossesIcone" id="progressTable" role="grid">
                                            <thead>
                                                <tr role="row">
                                                      <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 100px;">Name</th>
                                                      <th class="sorting boss" tabindex="0" rowspan="1" colspan="1" style="" title="Plus haut M+ la semaine dernière">M+ (-1)</th>
                                                      <th class="sorting boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="Plus haut niveau d'AP acquis">AP</th>
                                                      <th class="sorting boss" tabindex="0" rowspan="1" colspan="1" style="" title="Total d'AP recoltés">∑ AP</th>
                                                      <th class="sorting boss" tabindex="0" rowspan="1" colspan="1" style="width: 70px;" title="Total de dungeon mythic terminés">∑ Dung.</th>

                                                      <th class="boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="Hall of Valor"><img src="/img/m+/HoV.png"></th>
                                                      <th class="boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="Black Rook Hold"><img src="/img/m+/BRH.png"></th>
                                                      <th class="boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="The Arcway"><img src="/img/m+/Arcway.png"></th>
                                                      <th class="boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="Vault of the Wardens"><img src="/img/m+/VotW.png"></th>
                                                      <th class="boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="Eye of Azshara"><img src="/img/m+/EoA.png"></th>
                                                      <th class="boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="Neltharion's Lair"><img src="/img/m+/NL.png"></th>
                                                      <th class="boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="Court of Stars"><img src="/img/m+/CoS.png"></th>
                                                      <th class="boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="Darkheart Thicket"><img src="/img/m+/DHT.png"></th>
                                                      <th class="boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="Maw of Souls"><img src="/img/m+/MoS.png"></th>
                                                      <th class="boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="Lower Karazhan"><img src="/img/m+/KaraL.png"></th>
                                                      <th class="boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="Upper Karazhan"><img src="/img/m+/KaraH.png"></th>
                                                      <th class="boss" tabindex="0" rowspan="1" colspan="1" style="width: 10px;" title="Cathedral of Eternal Night"><img src="/img/m+/Cathe.png"></th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                              <% chars.forEach(function(chara){ %>
                                                <tr role="row">
                                                    <td>
                                                        <b><a href="/profile/<%= chara.realm %>/<%= chara.name %>">
                                                            <span name="<%= chara._id%>" style="color:<%=chara.getClassColor()%>"><%=chara.name%></span>
                                                        </a></b>
                                                    </td>
                                                    <%
                                                        var day = moment(chara.getLastMythicPlusLevel(1)).format('D');
                                                        var diff = moment().diff(chara.getLastMythicPlusLevel(1), 'days', false);
                                                    %>
                                                    <td style="<%if(diff > 5){%>color:red<% } %>">
                                                        <% if(chara.mPlusCache){ %>
                                                            <b><%= chara.getLastMythicPlusLevel(0); %></b>
                                                        <% }else{ %>
                                                        <%= chara.getLastMythicPlusLevel(0); %><% } %>
                                                        
                                                        <% if(chara.getLastMythicPlusLevel(0).substr(1) < 10 && diff <= 5){ %>
                                                            <span class="fa fa-warning"></span>
                                                        <% } %>    
                                                    </td>
                                                    <td style="">
                                                        <% var hAP = chara.highestArtLvl; %>
                                                        <%if(hAP >= 52){ %>
                                                            <b><%= hAP %></b>
                                                        <%}else{%>
                                                            <%= hAP %><%}%>
                                                    </td>
                                                    <td style="">
                                                        <% if(chara.artefactPower){ %>
                                                            <%= (chara.artefactPower).toLocaleString(); %>
                                                        <% } %>
                                                    </td>
                                                    <td style=""><%= chara.getSumDungeonBossKills(); %></td>

                                                    <td style=""><%= chara.progress.HoV%></td>
                                                    <td style=""><%= chara.progress.BRH%></td>
                                                    <td style=""><%= chara.progress.Arcway%></td>
                                                    <td style=""><%= chara.progress.VotW%></td>
                                                    <td style=""><%= chara.progress.EoA%></td>
                                                    <td style=""><%= chara.progress.NL%></td>
                                                    <td style=""><%= chara.progress.CoS%></td>
                                                    <td style=""><%= chara.progress.DHT%></td>
                                                    <td style=""><%= chara.progress.MaW%></td>
                                                    <td style=""><%= chara.progress.KaraL%></td>
                                                    <td style=""><%= chara.progress.KaraH%></td>
                                                    <td style=""><%= chara.progress.Cathe%></td>
                                                    
                                                </tr>
                                              <% }) %>
                                            </tbody>
                                        </table>
                                    <!-- END OF PROGRESS DUNGEONS & AP-->
                                </div>
                            </div>
                        </div>
                        
                        <div id="tab-3" class="tab-pane">
                            <div class="panel-body">
                                <div class="col-md-6">
                                    <!-- PROFESSIONS  -->
                                    <table class="table table-striped table-bordered table-hover dataTable listing-roster-items" id="professionTable" role="grid">
                                        <thead>
                                            <tr role="row">
                                                <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 100px;">Name</th>
                                                <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="min-width: 150px">Profession 1</th>
                                                <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 50px;"></th>
                                                <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="min-width: 150px">Profession 2</th>
                                                <th class="sorting" tabindex="0" rowspan="1" colspan="1" style="width: 50px;"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% chars.forEach(function(chara){ %>
                                                <tr role="row">
                                                    <td>
                                                        <b><a href="/profile/<%= chara.realm %>/<%= chara.name %>">
                                                          <span name="<%= chara._id%>" style="color:<%=chara.getClassColor()%>"><%=chara.name%></span>
                                                        </a></b>
                                                    </td>

                                                    <% for(var i=0; i< 2; i++){ %>
                                                    
                                                        <% if (chara.getProfessions()[i]){ %>
                                                            <td>
                                                                <span class="profileProf">
                                                                    <img src="<%= chara.getProfessionsIcon(chara.getProfessions()[i].icon) %>" width="20" height="20" class="profIcon bordered"/>
                                                                    <span class="
                                                                    <% for(var gather in chara.getListProfessionsGather()){ %>
                                                                        <% if(chara.getListProfessionsGather()[gather] == chara.getProfessions()[i].name){ %>
                                                                            text-navy
                                                                        <% } %>
                                                                    <% } %>
                                                                    "><b><%=chara.getProfessions()[i].name%></b<span> 
                                                                </span>
                                                            </td>
                                                            <td>
                                                                <% if(chara.getProfessions()[i].rank >= chara.getProfessions()[i].max){ %><b><% } %>
                                                                    <%= chara.getProfessions()[i].rank %>
                                                                <% if(chara.getProfessions()[i].rank >= chara.getProfessions()[i].max){ %></b><% } %>
                                                            </td>
                                                        <% }else { %>
                                                            <td><i>No profession</i></td>
                                                            <td><i>0</i></td>
                                                        <% } %>
                                                    <% } %>
                                                </tr>
                                            <% }) %>
                                        </tbody>
                                    </table>
                                    <!-- END OF PROFESSIONS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
               

            </div>
            <!-- END CONTENT BAR -->

            <!-- FOOTER BAR -->
            <% include partials/_footer %>
            <!-- END FOOTER BAR -->
        </div>
        <!-- END PAGE WRAPPER -->
        
    </div>

    <!-- Mainly scripts -->
    <script src="/js/jquery-2.1.1.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <script src="/js/plugins/jeditable/jquery.jeditable.js"></script>
    
    <!-- Data Tables -->
    <script src="/js/plugins/dataTables/jquery.dataTables.js"></script>
    <script src="/js/plugins/dataTables/dataTables.bootstrap.js"></script>
    <script src="/js/plugins/dataTables/dataTables.responsive.js"></script>
    <script src="/js/plugins/dataTables/dataTables.tableTools.min.js"></script>

    <!-- Custom and plugin javascript -->
    <script src="/js/inspinia.js"></script>
    <script src="/js/plugins/pace/pace.min.js"></script>
    
    <!-- WowHead ToolTip usage -->
    <script src="http://static.wowhead.com/widgets/power.js" type="text/javascript"></script>
    <script src="/js/wowhead_tooltips.js" type="text/javascript"></script>
    
    <%- include partials/_miscjs %>
    
    <script>
        $(document).ready(function() {
            
            $("#progressTable").DataTable({
                "searching" : true,
                "paging" : false,
                "bInfo" : true,
                "pageLength" : <%=chars.length%>,
                "order" : [],
                "search" :{
                    "regex" : true,
                    "smart": false
                }
            });
            
            $('#professionTable').DataTable({
                "searching" : true,
                "paging" : false,
                "bInfo" : true,
                "pageLength" : <%=chars.length%>,
                "order" : [],
                "search" :{
                    "regex" : true,
                    "smart": false
                }
            });
            
            $("#rosterTable").DataTable({
                "dom": '<"top"f>rt<"bottom"ilp><"clear">',
                "searching" : true,
                "paging" : false,
                "bInfo" : true,
                "pageLength" : <%=chars.length%>,
                "order" : [],
                "search" :{
                    "regex" : true,
                    "smart": false
                },
                "columnDefs":[{
                    "targets": [0,2],//role && classe
                    "visible": false
                    }
                ]
            });
            
            
            

        });
        
        
    </script>
    
    <script>
        $("button[name^='all_']").click(function(){
            var charInfos = $(this).attr("name").split("_")[1];
            
            $.post("/roster/updateAll", { 
                data: charInfos, 
                done: function(data){
                    console.log("Request for updateAllChar : "+charInfos);
                }   
            });
            $(this).children("i").addClass("fa fa-refresh").toggleClass("fa-spin");
            $(this).children("span").html("Processing");
            this.disabled = true;
            $(this).delay(1500).queue(function(){//delay only for animation, so custom function
                $(this).children("i").removeClass("fa-refresh fa-spin").addClass("fa-check");
                $(this).children("span").html("request sent");
            });
        });
    </script>
    
    <script>
        $(".emptySocket, .emptyEnchant").tooltip({
            container: "body",
            placement: "top",
            html: true
        });
        $(".ilvl").tooltip({
            container: "body",
            placement: "left",
            html: true
        });
        $(".artifactLevel").tooltip({
            container: "body",
            placement: "right",
            html: true
        });
        $(".more-infos").tooltip({
            container: "body",
            placement: "right",
            html: true
        });
        $(".token1, .token2, .token3").tooltip({
            container: "body",
            placement: "top",
            html: true
        });
        $(".profIcon").tooltip({
            container: "body",
            placement: "top",
            html: true
        });
        $(".boss").tooltip({
            container: "body",
            placement: "top",
            html: true
        })
    </script>
    
    <script>
        $("button[name='filterRoster']").click(function(){
            $("#filterRoster").toggle();
        });
    </script>
    
    <script>
        $("input[type=checkbox]").change(function(){
            if(!($(this).is(":checked"))){ //decoche
                oldSearch = $('.dataTables_filter input').val();
                
                oldSearch = oldSearch.replace($(this).val()+"|","").replace($(this).val(),"");
                
                str = cleanOr(oldSearch);
                
            }else{ //coche
                var oldSearch = $('.dataTables_filter input').val();
                var choosedString = $(this).val();

                choosedString += "|" + oldSearch; 

                str = cleanOr(choosedString);
            }
            $("#rosterTable").DataTable().search(str,true,false,true).draw();
        });
        
        function cleanOr(str){
            str = str.replace("||","|");
            if(str.slice(-1) === "|")
                str = str.slice(0, -1);
            if(str.slice(1) === "|")
                str = str.slice(1);
            return str;
        }
    </script>

</body>

</html>